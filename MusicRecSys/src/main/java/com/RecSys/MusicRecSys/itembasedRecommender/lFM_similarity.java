package com.RecSys.MusicRecSys.itembasedRecommender;

/*
 * 		WebMining Project: MSD		
 * 
 *  	lastFM similarity 
 * 		Java class creates two indexes ( track_index & reverse_track_index)
 * 
 * 
 * 		Code written by Daniel Riad, Hanna Farag, Amina Kadry, ï¿½mit Tepe
 * 
 * 		To-Do's:
 * 		- Creation of methods to look up in SQLite DB
 * 		- Current status: OutOfMemory Error (just look up for one specific ID!)
 */

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.HashMap;

public class lFM_similarity {
	private String track_id;
	private String path;
	private HashMap<String, String> track_index;
	private HashMap<String, String> reverse_track_index;

	public lFM_similarity(String path) {
		super();
		this.path = path;

		this.track_index = new HashMap<String, String>();
		this.reverse_track_index = new HashMap<String, String>();

	}

	public HashMap<String, String> getTrackIndex(String track_id) {

		// HashMap<String, String> track_index = new HashMap<String, String>();
		// HashMap<String, String> reverse_track_index = new HashMap<String,
		// String>();

		this.track_id = track_id;

		Connection c = null;
		// print 'We get all similar songs (with value) to %s' % tid
		// sql = "SELECT target FROM similars_src WHERE tid='%s'" % tid
		// Track id, with similar songs

		try {
			Statement stmt3 = null;
			// Statement 3
			Class.forName("org.sqlite.JDBC");
			c = DriverManager.getConnection(this.path);
			c.setAutoCommit(false);

			stmt3 = c.createStatement();
			ResultSet rs_lFM_sim = stmt3
					.executeQuery("SELECT target FROM similars_src WHERE tid ='"
							+ this.track_id + "';");
			while (rs_lFM_sim.next()) {
				// String track_id = rs_lFM_sim.getString("tid");
				String similar_tracks = rs_lFM_sim.getString("target");
				if (this.track_index.containsKey(this.track_id) != true) {
					this.track_index.put(this.track_id, similar_tracks);
				}

			}
			rs_lFM_sim.close();
			stmt3.close();
			c.close();
		} catch (Exception e) {
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}

		return this.track_index;
	}

	public HashMap<String, String> getReverseTrackIndex(String track_id) {

		// HashMap<String, String> track_index = new HashMap<String, String>();
		// HashMap<String, String> reverse_track_index = new HashMap<String,
		// String>();

		this.track_id = track_id;
		Connection c = null;
		try {
			Statement stmt4 = null;
			// print 'We get all songs which consider %s as similar' % tid
			// sql = "SELECT target FROM similars_dest WHERE tid='%s'" % tid

			Class.forName("org.sqlite.JDBC");
			c = DriverManager.getConnection(this.path);
			c.setAutoCommit(false);

			stmt4 = c.createStatement();
			ResultSet rs_lFM_rev_sim = stmt4
			// .executeQuery("SELECT tid, target FROM similars_dest;");
					.executeQuery("SELECT target FROM similars_dest WHERE tid= '"
							+ this.track_id + "';");
			// TRCCKNV128F149573B
			while (rs_lFM_rev_sim.next()) {
				// String track_id = rs_lFM_rev_sim.getString("tid");
				String referencing_tracks = rs_lFM_rev_sim.getString("target");
				if (this.reverse_track_index.containsKey(this.track_id) != true) {
					this.reverse_track_index.put(this.track_id,
							referencing_tracks);
				}

			}
			rs_lFM_rev_sim.close();
			stmt4.close();
			c.close();

		} catch (Exception e) {
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}

		return this.reverse_track_index;
	}

	// public static void main(String[] args) {
	//
	// // HashMap<String, String> track_index = new HashMap<String, String>();
	// // HashMap<String, String> reverse_track_index = new HashMap<String,
	// // String>();
	//
	// Connection c = null;
	// // print 'We get all similar songs (with value) to %s' % tid
	// // sql = "SELECT target FROM similars_src WHERE tid='%s'" % tid
	// // Track id, with similar songs
	//
	// try {
	// Statement stmt3 = null;
	// // Statement 3
	// Class.forName("org.sqlite.JDBC");
	// c = DriverManager
	// .getConnection("jdbc:sqlite:C:/Users/Laz/Desktop/WM Project/Datasets/lastfm_similars.db");
	// c.setAutoCommit(false);
	//
	// stmt3 = c.createStatement();
	// ResultSet rs_lFM_sim = stmt3
	// // .executeQuery("SELECT tid, target FROM similars_src;");
	// .executeQuery("SELECT target FROM similars_src WHERE tid ='TRCCKNV128F149573B';");
	// while (rs_lFM_sim.next()) {
	// // String artist_id = rs.getString("target");
	// // System.out.println( "ID = " + artist_id );
	// // String track_id = rs_lFM_sim.getString("tid");
	// String similar_tracks = rs_lFM_sim.getString("target");
	// System.out.println(similar_tracks);
	// // if (track_index.containsKey(track_id) != true) {
	// // track_index.put(track_id, similar_tracks);
	// // }
	//
	// }
	// rs_lFM_sim.close();
	// stmt3.close();
	// c.close();
	//
	// Statement stmt4 = null;
	// // Statement 4
	// // print 'We get all songs which consider %s as similar' % tid
	// // sql = "SELECT target FROM similars_dest WHERE tid='%s'" % tid
	//
	// Class.forName("org.sqlite.JDBC");
	// c = DriverManager
	// .getConnection("jdbc:sqlite:C:/Users/Laz/Desktop/WM Project/Datasets/lastfm_similars.db");
	// c.setAutoCommit(false);
	//
	// stmt4 = c.createStatement();
	// ResultSet rs_lFM_rev_sim = stmt4
	// // .executeQuery("SELECT tid, target FROM similars_dest;");
	// .executeQuery("SELECT target FROM similars_dest WHERE tid= 'TRCCKNV128F149573B';");
	// // TRCCKNV128F149573B
	// while (rs_lFM_rev_sim.next()) {
	// // String artist_id = rs.getString("target");
	// // System.out.println( "ID = " + artist_id );
	// // String track_id = rs_lFM_rev_sim.getString("tid");
	// String referencing_tracks = rs_lFM_rev_sim.getString("target");
	// System.out.println(referencing_tracks);
	// // if (reverse_track_index.containsKey(track_id) != true) {
	// // reverse_track_index.put(track_id, referencing_tracks);
	// // }
	//
	// }
	// rs_lFM_rev_sim.close();
	// stmt4.close();
	// c.close();
	//
	// //
	// TRATDSN128F1495748,1,TROPSQN128F92D93F5,0.316218,TRYVYGU128F4262945,0.305356,TRKAXBJ128F14B161D,0.225588,TRFEOFX128F428416A,0.221108,TRJILYS128F4276E31,0.218371,TRRALFU128F427234B,0.209114,TRVBVXQ128F145F1CC,0.202894,TRHRVVB128F425EE75,0.192053,TRITDQH128F4287D9B,0.181761,TRXPVFY128F4241349,0.173196,TRNAALR128F42883DD,0.17274,TRPLFEE128F428AE69,0.17274,TRSSAFD128E078F6FC,0.172479,TRBYEUQ128F1484CA2,0.166323,TRZSEMT12903CF2755,0.166323,TRRENWT128F93128F1,0.160781,TRVHOOC128F148C640,0.160781,TRUZRIX128E0791E97,0.150855,TREAFAN128F42ADF12,0.150488,TRMITRC128F426FC1C,0.147553,TRLHGFU128EF3519EE,0.145608,TRKUCEO128F4288525,0.14322,TRNYNAS128F92FFC9D,0.136738,TRBBKGH128F145684E,0.129544,TRNOLGD128F934318B,0.129162,TRYXRCV128F1484CA9,0.129162,TRAKNPI128EF34409B,0.128144,TRYMXEY128F930A293,0.125838,TRBHFNJ128F428B3B4,0.124554,TRMFVEL12903CAF840,0.123214,TRUNZWS12903CAF8FF,0.123214,TRJKEIG128F428CC50,0.120707,TRYQVXV12903CAF448,0.118976,TRFVLCN128F1484CA7,0.116527,TRPLRPW128F145421B,0.111618,TRQYIUO128F427D159,0.109666,TRJQYPW128F4264A77,0.109666,TRZSGJS128EF3519EF,0.109139,TRPAMTB12903CEBC8F,0.109139,TRWEGCT128F425551F,0.107984,TRIROTB128F429069C,0.105393,TRANPVC12903CD5010,0.105393,TRVTCCP128F424E065,0.0899437,TRVJNLL128F42ADF10,0.0865748,TRQJWAT128F92D949F,0.0832569,TRAQEBH128F92D949E,0.0813748,TRMKYBH128F4288D93,0.0785951,TRRHTVA12903D05429,0.0785951,TRXEUQS128F92FE4DF,0.0785951,TRGCSKF128F92EFD36,0.0742197,TROLLUR128F4292F61,0.0742197,TRYRNZL128F1490E84,0.0717283,TRIKCKJ128F9317BA5,0.006079,TRQHDQW128F9305C2D,0.00584269,TRBHINB128F9328ED3,0.00582814,TRXARYR12903CAAB00,0.00575106,TRGMWKK128F1480EBB,0.00531927,TRAKOKT128EF34FB84,0.00528932,TRJYARI128F92E5478,0.00516749,TRGOMQI128F93221AB,0.00505347,TRWDJCT128F4266335,0.00500188,TRFFUDF128F9307786,0.00500188,TRFATTD128F42741B0,0.00500188,TRIFWHQ12903D05421,0.00500188,TRENERY128F92DF76A,0.00500188,TROPPCQ128F92FCB61,0.00500188,TRMAJWF128F14A43CC,0.00499768,TRXDLRJ128F93221B4,0.00494062,TRMRQJD128E0781C51,0.00479928,TROQBRP128F4274891,0.00472412,TRJLZBF128F426572B,0.00471039,TRSGHOI128E078EFA6,0.00469192,TRLLKQR128F930DB99,0.00467936,TRRWDOC128F429DDEB,0.00462635,TRPMXOY128F424C775,0.00459956,TRVOPYH128F92DFAD7,0.00458905,TRVOUME128F9336E9E,0.00457572,TRLICOT128F427F9A7,0.00456415,TRWMLQD128F4259D7A,0.00455673,TRIYVZQ128F4259D7D,0.00455673,TRKKHWS128E0788A64,0.00455159,TRTAPMK128E0788A63,0.00453769,TRORDTG128F1493A5A,0.00453769,TRUORRQ128F931BEC8,0.00452082,TRSNLBZ12903D0CD19,0.00452082,TRDVZWX128F4269F43,0.00452082,TREDTFM128F429484F,0.00451658,TRFCPWW128F1495D9D,0.00446861,TRGXKYE128F930626C,0.00446233,TRBHZGT128F425064D,0.00445104,TRILGHP12903CCFFE7,0.00444723,TRFXCEO128F1471FB6,0.00441634,TRPRQWF128E078F4B4,0.00441292,TRMEHZV128F424C330,0.0043783,TRMYYCK128F4295A6A,0.00437342,TRWIFKD128F92E5471,0.00437342,TRAIBAI128F92E4FF8,0.00435725,TRGGAIN128F428BB0A,0.00435036,TRWZUDO128F1495E26,0.00433913,TRQAJVJ128F93190F4,0.00433794,TRNFEOZ128F428E283,0.00433564,TRSETJC128E0793A2C,0.00432622
	// //
	// TRJBWGH128F1491700,0.0227365,TRJTVBT128EF34DCAD,0.00119912,TRIDPYR128F9311A51,0.015487,TRMNIOV128F933966B,0.00459144,TRMFVEL12903CAF840,0.116767,TRMZSMI128F146404E,0.00169232,TRRABDR128EF34DCA8,0.00129948,TRRNQTI128F9314D0A,0.337186,TRYKITS12903CEB305,0.216482,TRYUZGR128EF34DC9F,0.00103966,TRAGRNZ128EF34DCA9,0.00105078,TRATDSN128F1495748,1,TRBLXZB128F145E03C,0.000937857,TRBUHRI128F9339665,0.00570833,TRLCLBQ12903CD20EF,0.48724,TRLKRGT128EF34DCA5,0.00176152,TRWDHVE128F42797FB,0.000752293,TRGUVGH128F1469830,0.00203956,TRKLXCL128F93393DE,0.320756,TRQOLFE12903CE5784,0.00164764,TRUBZWY128F9339671,0.00459144,TRUNZWS12903CAF8FF,0.116767,TRUPJGQ128EF34DCAA,0.000570436,TRUQROU128F424C51A,0.217354,TRCJSJR128F931B07C,0.00617881,TRCRTMI128F92E5403,0.286295,TRCBSWD128EF348F73,0.00051156,TRCFFDH128EF34DE8F,0.00305423,TRCFELZ128F9305CEB,0.0258822,TRCDDKL128F4267F8D,0.0681533,TRCWRJW128F42B9EC9,0.00131427,TRCTHLZ128F423FCC7,0.147934,TRJIQER128F42677D0,0.00182686,TRJOPWG128F9305CEF,0.0204788,TRJAMCS128F9319252,0.00819374,TRJEGDI128F14A26E0,0.00786182,TRJURWM128F9305CE9,0.0243369,TRILGHP12903CCFFE7,0.07672,TRIWQCK128E0785731,0.0126149,TRITGJG128E0792FB8,0.115593,TRIKGKV128F14A2A52,0.00770573,TRIQKTY128F1495B79,0.0019668,TRHIWYH128F92E5405,0.112197,TRHXHLD128F932F2EE,0.000974776,TRHYUJB128F4264E6B,0.00571817,TRHAGJW128E079684F,0.0702743,TRHSKNP128F4269467,0.0028386,TRHGXNB128EF34DEAA,0.00173079,TRXJGKQ128F4264057,0.000651137,TRXHGFU128F424E7C5,0.00449642,TRXXACA128F931B3FB,0.00173079,TRXYMYF128F931B640,0.00153902,TRXDMOP128F92D94A1,0.144894,TRXLUVZ128F14A2A64,0.00264713,TRXPNDB128F933D312,0.00398802,TRXZDTW128F42876D2,0.00617881,TRXKNGN128F1456BA6,0.00193954,TRXVSIM128F42629C0,0.00180511,TROMEML128F930EE31,0.011715,TROAGBZ128F4264CE3,0.366222,TROFVZY128F429F100,0.0121856,TROPPDV128E0781E41,0.00118487,TROWBKQ128F1456BAB,0.0010663,TROZBFX128F4262A70,0.299187,TROKWZC128F14A2A53,0.0104195,TROVIIB12903CE69A5,0.02087,TRMXVJA128F4234B59,0.0183766,TRMOYMD128F145BB22,0.304245,TRMAHGM128E0791C56,0.00405715,TRMBEMY128F422FC22,0.00820345,TRMNWRJ128E0799ACE,0.000703068,TRMPWAH128F9339673,0.00739642,TRMZZEM128F1495B76,0.0114245,TRMGFKR128F42618B8,0.00930667,TRMGQBY128F1474B22,0.00321667,TRMKYBF128F930EE23,0.00427439,TRMVGZS128F148AA52,0.00779179,TRRCXXV128F932F2BD,0.00213589,TRRINLB128F4237B75,0.0131,TRRRIFT128F1468666,0.00223955,TRRDYUY128F422FC23,0.00838043,TRRLNPS128EF355B68,0.00199907,TRRLFCP128F932CED4,0.0408964,TRRGNZL128E0783399,0.00281457,TRRQYXG128F14A2A4C,0.0146386,TRYIKPR128F429C28D,0.0148801,TRYOWOU128F425FB64,0.00159525,TRYYYWS128EF34A1FF,0.000667811,TRYAHFA12903CD94E3,0.0251258,TRYNJBH128F1492220,0.00170892,TRYSRVN12903CE69B0,0.0530227,TRYZLCY128F4265866,0.000897284,TRYTIIW128F9340A4E,0.00256445,TRYTDGF128F42B9EC2,0.00131661,TRARHAW128F145D159,0.0162348,TRASQXS128F4270B02,0.0681533,TRAZHZJ128F428E851,0.00145532,TRAZEEF128E0796856,0.0631679,TRATFYW128F42B9EC4,0.00134893,TRAQEBH128F92D949E,0.146428,TRBCXBV128F4230776,0.0016635,TRBHECG128F4294CDC,0.00069837,TRBHWGC128E078CF83,0.027648,TRBMKVF128E0789440,0.00244601,TRBEQKP128F1456BA5,0.00161167,TRBLVMN128F4272C96,0.00180511,TRBPIPV128F14A26E3,0.00125857,TRBPPBO128EF34DE92,0.00351997,TRBPTYU128F145BB29,0.318657,TRBWMSD128F149F02B,0.00455735,TRBGTEZ128F426A774,1,TRBVLAN128F149CB0F,0.00617881,TRNCOVY128F42555DE,0.00117097,TRNIUSG128E0782594,0.00209792,TRNXYLC128E07844D0,0.00148009,TRNOJAL128F933E3E7,0.00151082,TRNMEFY128F421C0A9,0.0832182,TRNRILF128F4266C43,0.0482367,TRNDQBK128E0792EB4,0.0434347,TRNUSCW128F424116A,0.112039,TRSRMHD128F92E545F,0.00221863,TRSBDPS128F42307F4,0.00943886,TRSNQRZ128E0784225,0.00571817,TRSLRPM128F935E3D0,0.116833,TRSLPUL128E078338A,0.0018982,TRSZQBO128F9305CF3,0.0220871,TRSGTUG128F429A298,0.00546356,TRSTVHK128F93192F5,0.0128848,TRSQCKP128F14A2A3E,0.00175291,TRFXNVS128F1456BB1,0.00126499,TRFYWXI128F1497940,0.0337397,TRFSKPH128F1456BA8,0.00259939,TRFFJUH128F14AEC0A,0.217932,TRFEOFX128F428416A,0.542515,TRFZQAN12903CB2B0D,0.0206495,TRFVZJE128C719696A,0.000566982,TRDCDOT128F93192EC,0.00839704,TRDHOQO128F42B9EC7,0.000976946,TRDOCXH128F429996D,0.00069838,TRDAOQD128F930EE30,0.0102082,TRDLBVV128F425FB67,0.00411601,TRDWGIG128F42862FC,0.00147789,TRDKRUV128EF341CFE,0.00855393,TRDQGRZ128F931B3FA,0.00148009,TRDULCA128E078338C,0.00257901,TREYXOF128F427060A,0.00144279,TREAIRF128F149EAEA,0.00102159,TRENWPP128F149633F,0.00145532,TRESAJQ128F92DEBB6,0.337186,TREDQAI12903CBA530,0.00405715,TREZRIA128F146C546,0.00153421,TREQBNK128F14963A0,0.000566982,TREUKRF128F14A26DE,0.00572534,TRLIFMC12903CE6999,0.0522548,TRLHYDD128F1490717,0.0912966,TRLOFPV128F14964B3,0.00153302,TRLACNL128F148D241,0.00144276,TRLBSEH128F148D248,0.00103092,TRLBZSQ128F92F1BE8,0.0054626,TRLNGSF12903CEF018,0.078353,TRLSLGV128F42677D4,0.0419957,TRLZCDC128EF34DE9F,0.00167717,TRLGUJG128F148D247,0.00174269,TRPIBBE128F14963B1,0.00196589,TRPDLYL12903CBAD7F,0.00144279,TRPGBBU128E0781FF2,0.00204618,TRWIUED128EF34DE93,0.00306323,TRWHJHV128F92E547B,0.0103402,TRWBHRV128E0784CD3,0.00324373,TRWNMPD12903CF63F7,0.191147,TRWLNLX128F147E1FF,0.00411601,TRWPDNU128E078338F,0.00175243,TRWQSTU128E0792DC3,0.00145961,TRZIAAZ128F42B9EB6,0.0011918,TRZHCQZ128F1480868,0.143186,TRZPHQM128F932F2BA,0.00213589,TRZTYBL12903CE69BC,0.0640766,TRZQERV128F931BEFC,0.00214062,TRZQLPF128F9308400,0.0150193,TRGRJTS128EF34DE80,0.00213589,TRGYHWM128F92CD166,0.00130783,TRGYMHO128F9309C57,0.00538508,TRGLCEJ128F14958AF,0.00851753,TRGLXDJ128F93321C4,0.00418382,TRGGDUP128F427AA32,0.268986,TRGTMZK128F93192E4,0.00841055,TRGKYWM128F426AF0A,0.00144279,TRGQMBD128F9319288,0.00959681,TRGVBDI128F4294EBF,0.00151011,TRTHISB128F14A2A5D,0.00734658,TRTYTUS128F1463A0A,0.00427439,TRTYUJW128F42B9EBA,0.00148866,TRTAARA128F9319278,0.0113317,TRTSEGM128F4228996,0.00223603,TRTEZXS128F9339663,0.00739642,TRTULAY128F14624AA,0.0265447,TRTULVJ128E078338B,0.00279177,TRKXCIK128F42B9EC1,0.0013166,TRKYBEW128F1463A18,0.00455735,TRKAXBJ128F14B161D,0.127336,TRKNJQO128F42758F1,0.032429,TRKNEKV128F1490719,0.121982,TRKPUVZ128F9319291,0.00853791,TRKQVDR128F42876CE,0.0121856,TRKUXRB128F427B110,5.87932e-05,TRKVGZY128F425D579,0.00348946,TRQJBIN128F422FC1B,0.00206584,TRQYZXS128F9305CEA,0.0223987,TRQWFGN128F9319266,0.00975083,TRUIQAI128F93192B3,0.00820115,TRUMKJR128F92CD1B1,0.00179365,TRURWFT128F9301FE7,0.000974776,TRURWCX128F42B9EB8,0.00122088,TRUASTV128F931B3FE,0.00173079,TRUALYV12903CE69B6,0.036657,TRUNBLF128F42B9EC0,0.0011918,TRUSZHV128E079684B,0.0306891,TRUFUBA128F14B0FA9,0.0119099,TRUDUIO128F14A2A51,0.010419,TRUEKUE128F932280B,0.00321667,TRUWJUZ128F42770D0,0.00703043,TRUGGYM128F425FB60,0.00189802,TRUUZCB128F149071A,0.063754,TRVCWJQ12903CF2E4C,0.0227545,TRVJTWE128F14AEC0B,0.229669,TRVHKRA12903CB2B0A,0.033283,TRVSBUZ128F148AA51,0.00112004,TRVPMHS128F424E063,0.0885944,TRVPZOL128F42862FD,0.00706331,TRVKOXB128F9344BE8,0.00954713,TRVUDGB128F424DFCB,0.0346408
	//
	//
	//
	// } catch (Exception e) {
	// System.err.println(e.getClass().getName() + ": " + e.getMessage());
	// System.exit(0);
	// }
	//
	// }

}
